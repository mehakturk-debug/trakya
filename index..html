<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trakya BÃ¶lgesi Teberru ProgramÄ±</title>
    <style>
        :root {
            --bg-color: #050505;
            --neon-yellow: #f1c40f;
            --neon-shadow: 0 0 15px #f1c40f;
            --card-bg: #121212;
            --text-color: #ffffff;
        }

        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }

        .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #222; padding-bottom: 15px; }
        .breadcrumb { font-size: 1.4rem; color: var(--neon-yellow); text-shadow: var(--neon-shadow); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        
        .btn { padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; border: 2px solid var(--neon-yellow); background: transparent; color: var(--neon-yellow); text-transform: uppercase; display: inline-flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        .btn:hover { background: var(--neon-yellow); color: #000; box-shadow: var(--neon-shadow); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }

        /* Neon Kartlar */
        .neon-card {
            background: var(--card-bg); border: 2px solid #333; border-radius: 15px; height: 200px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.4s; position: relative; overflow: hidden;
        }
        .neon-card:hover { border-color: var(--neon-yellow); transform: scale(1.02); box-shadow: var(--neon-shadow); }
        .neon-card .plaka { font-size: 5rem; font-weight: 900; color: #1a1a1a; position: absolute; bottom: -10px; right: 10px; z-index: 1; }
        .neon-card .name { font-size: 1.8rem; font-weight: bold; z-index: 2; text-shadow: 2px 2px 5px #000; text-align: center; }
        
        .info-badges { position: absolute; top: 15px; left: 15px; display: flex; flex-direction: column; gap: 5px; z-index: 3; }
        .badge-count { background: var(--neon-yellow); color: #000; padding: 3px 12px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
        .badge-money { background: #27ae60; color: white; padding: 3px 12px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; box-shadow: 0 0 10px rgba(39, 174, 96, 0.4); }

        /* DÃ¼kkan KartlarÄ± */
        .shop-card { background: var(--card-bg); border-radius: 15px; border: 1px solid #333; overflow: hidden; position: relative; border-bottom: 4px solid var(--neon-yellow); }
        .shop-order { position: absolute; top: 12px; left: 12px; background: rgba(0,0,0,0.8); color: var(--neon-yellow); width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid var(--neon-yellow); font-weight: bold; z-index: 5; }
        .shop-content { padding: 25px; }
        .teberru { color: var(--neon-yellow); font-weight: bold; border: 1px solid var(--neon-yellow); padding: 5px 15px; border-radius: 20px; float: right; font-size: 1rem; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); }
        .modal-content { background: #1a1a1a; width: 90%; max-width: 500px; margin: 2% auto; padding: 30px; border: 2px solid var(--neon-yellow); border-radius: 20px; box-shadow: var(--neon-shadow); }
        input, textarea { width: 100%; padding: 14px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        input:focus { border-color: var(--neon-yellow); outline: none; }
        
        .hidden { display: none; }
        .loader { text-align: center; padding: 50px; color: var(--neon-yellow); font-size: 1.5rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-nav">
        <div id="breadcrumb" class="breadcrumb">TRAKYA BÃ–LGESÄ° TEBERRU PROGRAMI</div>
        <button id="backBtn" class="btn hidden" onclick="goBack()">â¬… GERÄ° DÃ–N</button>
    </div>
    <div id="mainGrid" class="grid"></div>
</div>

<div id="itemModal" class="modal">
    <div class="modal-content">
        <h3 style="color: var(--neon-yellow); margin-top:0">ðŸ”’ YENÄ° KAYIT YETKÄ°LENDÄ°RME</h3>
        <input type="password" id="adminPass" placeholder="YÃ¶netici Åžifresini Giriniz" style="border-color: #e74c3c;">
        <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
        <div style="display: flex; gap: 10px;">
            <input type="number" id="orderNo" placeholder="SÄ±ra No">
            <input type="text" id="amount" placeholder="Miktar (Ã–rn: 5000)">
        </div>
        <input type="text" id="name" placeholder="DÃ¼kkan AdÄ±">
        <input type="text" id="owner" placeholder="DÃ¼kkan Sahibi">
        <input type="tel" id="phone" placeholder="Telefon (05xx...)">
        <input type="text" id="maps" placeholder="Google Maps Linki">
        <textarea id="desc" placeholder="KÄ±sa AÃ§Ä±klama..." rows="2"></textarea>
        <button id="saveBtn" class="btn" style="width:100%; margin-top:10px" onclick="saveShop()">VERÄ°TABANINA GÃ–NDER</button>
        <button class="btn" style="width:100%; margin-top:10px; border-color:#555; color:#555" onclick="closeModal()">Ä°PTAL</button>
    </div>
</div>

<script>
    // --- KONFÄ°GÃœRASYON ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyo51xVvNS5tYPeKQjEWfPqT-V_gcR6I-q3cQHoio9qXM1tfa99rk2I94rqr45p7dHx8w/exec";
    const ADMIN_PASSWORD = "1234"; 
    // ---------------------

    const cityData = {
        "TEKÄ°RDAÄž": { plaka: "59", districts: ["SÃ¼leymanpaÅŸa", "Ã‡orlu", "Ã‡erkezkÃ¶y", "Ergene", "KapaklÄ±", "Malkara", "Saray", "Hayrabolu", "ÅžarkÃ¶y", "MuratlÄ±", "MarmaraereÄŸlisi"] },
        "EDÄ°RNE": { plaka: "22", districts: ["Merkez", "KeÅŸan", "UzunkÃ¶prÃ¼", "Ä°psala", "Havsa", "MeriÃ§", "Enez", "SÃ¼loÄŸlu", "LalapaÅŸa"] },
        "KIRKLARELÄ°": { plaka: "39", districts: ["Merkez", "LÃ¼leburgaz", "Babaeski", "Vize", "PÄ±narhisar", "DemirkÃ¶y", "PehlivankÃ¶y", "KofÃ§az"] },
        "Ã‡ANAKKALE": { plaka: "17", districts: ["Merkez", "Biga", "Ã‡an", "Gelibolu", "Yenice", "AyvacÄ±k", "Ezine", "BayramiÃ§", "Lapseki", "Eceabat", "GÃ¶kÃ§eada", "Bozcaada"] }
    };

    let db = {}; 
    let currentCity = null, currentDist = null;

    async function fetchDB() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = '<div class="loader">Bulut VeritabanÄ±na BaÄŸlanÄ±lÄ±yor...</div>';
        
        try {
            const response = await fetch(SCRIPT_URL);
            const rows = await response.json();
            db = {};
            rows.slice(1).forEach(r => {
                const key = `${r[0]}-${r[1]}`;
                if(!db[key]) db[key] = [];
                db[key].push({ order:r[2], name:r[3], owner:r[4], phone:r[5], amount:r[6], desc:r[7], img:r[8], maps:r[9] });
            });
            render();
        } catch (e) {
            grid.innerHTML = '<div class="loader" style="color:red">BaÄŸlantÄ± HatasÄ±! LÃ¼tfen internetinizi kontrol edin.</div>';
        }
    }

    function parseMoney(str) { return parseInt(str.toString().replace(/[^0-9]/g, '')) || 0; }

    function getStats(city, dist = null) {
        let money = 0, count = 0;
        const process = (k) => { (db[k] || []).forEach(s => { count++; money += parseMoney(s.amount); }); };
        if(dist) process(`${city}-${dist}`);
        else cityData[city].districts.forEach(d => process(`${city}-${d}`));
        return { money, count };
    }

    function render() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "";
        if (!currentCity) {
            document.getElementById('backBtn').classList.add('hidden');
            document.getElementById('breadcrumb').innerText = "TRAKYA BÃ–LGESÄ° TEBERRU PROGRAMI";
            Object.keys(cityData).forEach(city => {
                const s = getStats(city);
                const card = createNeonCard(city, cityData[city].plaka, () => { currentCity = city; render(); });
                card.style.height = "250px";
                if(s.count > 0) card.innerHTML += `<div class="info-badges"><div class="badge-count">${s.count} ADRES</div><div class="badge-money">${s.money.toLocaleString()} TL</div></div>`;
                grid.appendChild(card);
            });
        } else if (!currentDist) {
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('breadcrumb').innerText = `ðŸ“ ${currentCity} / Ä°LÃ‡ELER`;
            [...cityData[currentCity].districts].sort((a,b)=>getStats(currentCity,b).count - getStats(currentCity,a).count).forEach(dist => {
                const s = getStats(currentCity, dist);
                const card = createNeonCard(dist, "", () => { currentDist = dist; render(); });
                if(s.count > 0) card.innerHTML += `<div class="info-badges"><div class="badge-count">${s.count} ADRES</div><div class="badge-money">${s.money.toLocaleString()} TL</div></div>`;
                grid.appendChild(card);
            });
        } else {
            document.getElementById('breadcrumb').innerText = `ðŸ“ ${currentCity} > ${currentDist}`;
            const shops = (db[`${currentCity}-${currentDist}`] || []).sort((a,b)=> (parseInt(a.order)||99) - (parseInt(b.order)||99));
            shops.forEach((shop, idx) => {
                const div = document.createElement('div');
                div.className = 'shop-card';
                div.innerHTML = `
                    <div class="shop-order">${shop.order || (idx+1)}</div>
                    <div class="shop-content">
                        <span class="teberru">${parseMoney(shop.amount).toLocaleString()} TL</span>
                        <h3 style="margin:0 0 10px 0; color:var(--neon-yellow)">${shop.name}</h3>
                        <p style="margin:5px 0"><b>Sahibi:</b> ${shop.owner}</p>
                        <p style="margin:5px 0; color:var(--neon-yellow)"><b>ðŸ“ž ${shop.phone}</b></p>
                        <p style="font-size:0.85rem; color:#888; margin-bottom:15px">${shop.desc}</p>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
                            <a href="${shop.maps}" target="_blank" class="btn" style="font-size:11px; padding:10px">YOL TARÄ°FÄ°</a>
                            <a href="tel:${shop.phone}" class="btn" style="font-size:11px; background:#27ae60; color:white; border-color:#27ae60">HEMEN ARA</a>
                        </div>
                    </div>`;
                grid.appendChild(div);
            });
            const add = createNeonCard("YENÄ° KAYIT EKLE", "+", () => openModal());
            add.style.borderStyle = "dashed"; grid.appendChild(add);
        }
    }

    function createNeonCard(name, plaka, onClick) {
        const div = document.createElement('div');
        div.className = 'neon-card'; div.onclick = onClick;
        div.innerHTML = `<div class="name">${name}</div>${plaka ? `<div class="plaka">${plaka}</div>` : ''}`;
        return div;
    }

    function openModal() { document.getElementById('itemModal').style.display = 'block'; }
    function closeModal() { document.getElementById('itemModal').style.display = 'none'; document.querySelectorAll('input, textarea').forEach(i=>i.value=""); }

    async function saveShop() {
        if(document.getElementById('adminPass').value !== ADMIN_PASSWORD) { alert("Åžifre YanlÄ±ÅŸ! Yetkiniz bulunmuyor."); return; }
        
        const saveBtn = document.getElementById('saveBtn');
        saveBtn.innerText = "BULUTA GÃ–NDERÄ°LÄ°YOR...";
        saveBtn.disabled = true;

        const shopObj = {
            city: currentCity, dist: currentDist,
            order: document.getElementById('orderNo').value,
            name: document.getElementById('name').value,
            owner: document.getElementById('owner').value,
            phone: document.getElementById('phone').value,
            amount: document.getElementById('amount').value,
            desc: document.getElementById('desc').value,
            img: "", maps: document.getElementById('maps').value
        };

        try {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(shopObj) });
            closeModal();
            fetchDB();
        } catch (e) {
            alert("KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu!");
        } finally {
            saveBtn.innerText = "VERÄ°TABANINA GÃ–NDER";
            saveBtn.disabled = false;
        }
    }

    function goBack() { if(currentDist) currentDist = null; else if(currentCity) currentCity = null; render(); }
    fetchDB();
</script>
</body>
</html>